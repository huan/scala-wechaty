<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>FriendshipRawSupport.scala</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">wechaty_2.12</a> &gt; <a href="../index.html" class="el_bundle">wechaty-hostie_2.12</a> &gt; <a href="index.source.html" class="el_package">wechaty.hostie.support</a> &gt; <span class="el_source">FriendshipRawSupport.scala</span></div><h1>FriendshipRawSupport.scala</h1><pre class="source lang-java linenums">package wechaty.hostie.support

import io.github.wechaty.grpc.puppet.Friendship
import wechaty.puppet.Puppet
import wechaty.puppet.schemas.Friendship._

/**
  *
  * @author &lt;a href=&quot;mailto:jcai@ganshane.com&quot;&gt;Jun Tsai&lt;/a&gt;
  * @since 2020-06-06
  */
<span class="fc" id="L12">trait FriendshipRawSupport {</span>
  self: Puppet with GrpcSupport =&gt;
  /**
    *
    * Friendship
    *
    */
  override def friendshipAccept(friendshipId: String): Unit = {
<span class="fc" id="L20">    val request = Friendship.FriendshipAcceptRequest.newBuilder()</span>
<span class="fc" id="L21">      .setId(friendshipId)</span>
      .build()
<span class="fc" id="L23">    grpcClient.friendshipAccept(request)</span>
  }

  override def friendshipAdd(contactId: String, hello: String): Unit = {
<span class="nc" id="L27">    val request = Friendship.FriendshipAddRequest.newBuilder()</span>
<span class="nc" id="L28">      .setContactId(contactId)</span>
<span class="nc" id="L29">      .setHello(hello)</span>
      .build()

<span class="nc" id="L32">    grpcClient.friendshipAdd(request)</span>
  }

  override def friendshipSearchPhone(phone: String): String = {
<span class="nc" id="L36">    val request = Friendship.FriendshipSearchPhoneRequest.newBuilder()</span>
<span class="nc" id="L37">      .setPhone(phone)</span>
      .build()
<span class="nc" id="L39">    val response = grpcClient.friendshipSearchPhone(request)</span>
<span class="nc" id="L40">    response.getContactId.getValue</span>
  }

  override def friendshipSearchWeixin(weixin: String): String = {
<span class="nc" id="L44">    val request = Friendship.FriendshipSearchWeixinRequest.newBuilder()</span>
<span class="nc" id="L45">      .setWeixin(weixin)</span>
      .build()

<span class="nc" id="L48">    val response = grpcClient.friendshipSearchWeixin(request)</span>
<span class="nc" id="L49">    response.getContactId.getValue</span>
  }

  override protected def friendshipRawPayload(friendshipId: String): wechaty.puppet.schemas.Friendship.FriendshipPayload = {
<span class="fc" id="L53">    val request = Friendship.FriendshipPayloadRequest.newBuilder()</span>
<span class="fc" id="L54">      .setId(friendshipId)</span>
      .build()

<span class="fc" id="L57">    val response = grpcClient.friendshipPayload(request)</span>
    val payload =
<span class="fc" id="L59">    response.getType match {</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">      case Friendship.FriendshipType.FRIENDSHIP_TYPE_CONFIRM =&gt;</span>
<span class="fc" id="L61">        val confirm = new FriendshipPayloadConfirm()</span>
<span class="fc" id="L62">        confirm</span>
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">      case Friendship.FriendshipType.FRIENDSHIP_TYPE_RECEIVE=&gt;</span>
<span class="fc" id="L64">        val receive = new FriendshipPayloadReceive()</span>
<span class="fc" id="L65">        receive.scene = FriendshipSceneType.apply(response.getSceneValue)</span>
<span class="fc" id="L66">        receive.stranger = response.getStranger</span>
<span class="fc" id="L67">        receive.ticket = response.getTicket</span>
<span class="fc" id="L68">        receive</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">      case Friendship.FriendshipType.FRIENDSHIP_TYPE_VERIFY=&gt;</span>
<span class="nc" id="L70">        new FriendshipPayloadVerify()</span>
      case other =&gt;
<span class="nc" id="L72">        new FriendshipPayload()</span>
    }

<span class="fc" id="L75">    payload.hello = response.getHello</span>
<span class="fc" id="L76">    payload.`type` = FriendshipType.apply(response.getTypeValue)</span>
<span class="fc" id="L77">    payload.contactId = response.getContactId</span>
<span class="fc" id="L78">    payload.id = response.getId</span>

<span class="fc" id="L80">    payload</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>